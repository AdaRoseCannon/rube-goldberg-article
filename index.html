<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- COMMON TAGS -->
<meta charset="utf-8">

		<title>A Rube Goldberg Machine</title>
		<!-- Search Engine -->
		<meta name="description" content="CSS Custom Properties, Grid and Web Animations, an introduction to post-modern Web Development.">
		<meta name="image" content="https://i.imgur.com/xYs7uhO.png">
		<!-- Schema.org for Google -->
		<meta itemprop="name" content="A Rube Goldberg Machine">
		<meta itemprop="description" content="CSS Custom Properties, Grid and Web Animations, an introduction to post-modern Web Development.">
		<meta itemprop="image" content="https://i.imgur.com/xYs7uhO.png">
		<!-- Twitter -->
		<meta name="twitter:card" content="summary">
		<meta name="twitter:title" content="A Rube Goldberg Machine">
		<meta name="twitter:description" content="CSS Custom Properties, Grid and Web Animations, an introduction to post-modern Web Development.">
		<meta name="twitter:site" content="@lady_ada_king">
		<meta name="twitter:creator" content="@lady_ada_king">
		<meta name="twitter:image:src" content="https://i.imgur.com/xYs7uhO.png">
		<!-- Twitter - Article -->
		<!-- Open Graph general (Facebook, Pinterest & Google+) -->
		<meta name="og:title" content="A Rube Goldberg Machine">
		<meta name="og:description" content="CSS Custom Properties, Grid and Web Animations, an introduction to post-modern Web Development.">
		<meta name="og:image" content="https://i.imgur.com/xYs7uhO.png">
		<meta name="og:url" content="https://samsunginter.net/rube-goldberg-article/">
		<meta name="og:type" content="article">
		<!-- Open Graph - Article -->
		<meta name="article:section" content="Technology">
		<meta name="article:author" content="Ada Rose Edwards">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link href="./style.css" rel="stylesheet">
		<link href="./easings.css" rel="stylesheet">
		<link href="https://ada.is/computer-modern/Serif/cmun-serif.css" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>

		<style>

			:root {
				--blue: #428FCF;
				--magenta: #FF54FF;
			}

			#grid-container > h2 {
				padding: var(--padding);
				background-color: var(--blue);
				color: white;
			}

			#grid-container > section.header {
				display: flex;
				flex-direction: column;
				align-content: center;
				justify-content: center;
				background-color: var(--blue);
				color: white;
			}
		</style>
	</head>
	<body><main id="grid-container">
		<section class="header">
			<h1 id="title">A Rube Goldberg Machine</h1>
			<h2 id="subtitle">An introduction to post-modern Web Development</h2>
		</section>

		<img src="images/rube.svg" style="width: 100%; max-width: 560px;margin: 0 auto;" />

		<span style="display: flex; height: 100%; width: 100%; align-items: center; justify-content: center; font-size: 2.5em; color: rgba(70,50,0,0.3);	margin-left: 0; margin-right: 0; padding-right: 0; padding-left: 0; grid-column-start: 2;">Whitespace &lt;3</span>

		<section>
			<div class="columns">
				<p>This blog post was inspired by the wonderful talks from <a href="https://vimeo.com/channels/cssday">CSS-Day Amsterdam 2017</a>. Especially those of Rachel Nabors, Rachel Andrew and Jen Simmons. Many of these talks introduced newer browser APIs to give framework levels of functionality built into the browser.</p>
				<p>The title of this article refers to a Rube Goldberg machine, a machine which uses many interlocking moving parts to perform a function, these new APIs although very different can all work together to produce a wonderful web experience.</p>
				<p>These new APIs are designed to be used as-is rather than requiring a CSS or JavaScript library to assist them. Their high-level power allows them to be thought of as frameworks built into the web platform for assisting with problems often found in front end web development.</p>
				<p>This offers great benefits for performance. As there is no overhead on external dependencies, they also have great support considering how new they are.</p>
				<p>These new APIs are powerful individually but also they complement each other beautifully, CSS custom properties being the common thread which goes through them all as it is a low level change to CSS.</p>
				<p>Together they enable us to produce beautiful Websites written with symantic HTML where all the visual and animation design is in the CSS and the interactivity is added with JavaScript.</p>
			</div>

			<h2>Topics covered:</h2>

			<ul>
				<li><a href="#css-grid">CSS Grid</a></li>
				<li><a href="#css-custom-properties">CSS Custom Properties, also known as CSS Variables</a></li>
				<li><a href="#web-animations">Web Animations</a></li>
			</ul>
		</section>
		
		<h2 id="css-grid">CSS Grid</h2>
		
		<section>
			<p><script>
			if (CSS && CSS.supports) {
				if (!CSS.supports('display' , 'grid')) {
					document.write('Your browser may not support CSS Grid, some of these Demos may not work.');
				}else {
					document.write('Your browser supports CSS Grid!');
				}
			} else {
				document.write('Can\'t detect CSS Grid Support');
			}
			</script></p>
			<section class="columns">
				<p>Grid layout feels like the most significant CSS API addition since FlexBox. Like flexbox enabled powerful 1-dimensional layouts; Grid enables beautiful 2-dimensional layouts.</p>
				<p>Grid isn't a flexbox replacement, where a layout is 1 dimensional e.g. a single row/column such as in a component flexbox maybe more useful.</p>
				<p>A good rule of thumb is Grid for page layouts and Flexbox for components. But feel free to use whichever tool feels best for your situation.</p>

				<p>CSS grid allows you to divide your page up into a template with columns and rows and label areas of your grid.</p>
				<p>With CSS Grid you are not restricted to 12 fixed width columns like many popular grid libaries.</p>
				<p>The grid of CSS Grid can have any number of rows and columns of unequal sizes. It can also automatically add rows or columns to allow it to grow horizontally or vertically as more content is added.</p>
				<div id="grid-example">
					<span style="grid-column-end: span 2;"><code class="css">grid-column-end: span 2;</code></span>
					<span></span>
					<span></span>
					<span></span>
					<span></span>
				</div>
				<p>CSS Grid enables one to define, how the grid columns and rows behave with granularity. The contents are the automatically placed into the grid to fill the available space. See <i>Figure 1.</i></p>
				<p>It also introduces new CSS units and functions enabling us define the widths and heights of columns and rows in relation to the contents or the remaining space in the grid.</p>
				<p>Like with Flexbox it is going to take a while for the Web community to come to grips with the full power of Grids, but once we do layout on the web will rival the beauty of print.</p>
			</section>

		</section>

		<figure class="embed">
			<div id="grid-placement-demo">
				<h2>Four Column Grid</h2>
				<p>The title is the first element, I have set it's writing mode to vertical, the browser accounts for this in working out the size of the grid columns. Each paragraph is set to span 2 columns.</p>
				<img width="256" src="images/logo1.png" style="grid-column-start: 2;"/>
				<p>The previous image has <code class="css">grid-column-start: 2;</code> so it starts from the first free cell after the second boundary, without reordering. The image width is set to 100% so that it fills the column width.  This paragraph gets placed immediately after the image because there are still two horizontal cells avaialble for it to fill in this row.</p>

				<p style="grid-column: 1/-1;">This paragraph is set to span the full width of the grid, this is done by setting <code class="css">grid-column: 1/-1;</code> aka, This goes from the first grid boundary (1) to the last (4 or -1)</p>
			</div>
			<figcaption>CSS Grid Example with Text and Images</figcaption>
		</figure>

		<section>
			<div class="columns">
				<p>CSS Grid is great for very stylised layouts. Elements placed into the grid are kept pefectly inline with each other. You have lots of control to place elements in any column or row on the page. This property is very useful for controlled use of empty spaces. Empty areas on your page can make it much easier to read by reducing clutter and helping flow.</p>
				<p>CSS Grid layouts are Analogous to how real print documents are laid out from the pages of tabloid magazines to avant-garde works of post modern print.</p>
				<p>They ensure that elements in the page line up with other elements even if they are of different sizes.</p>
				<p>Notice how in Figure 1. the 1st column, the one with the vertical header, is the same width as the header. This is because the columns for the grid are set to <code>min-content repeat(3, 1fr)</code> which is equivalent to <code>min-content 1fr 1fr 1fr</code>, so 4 columns the first is the smallest content wide, each column then recieves 1 fraction of the remaining space.</p>
				<p>This has the nice property of keeping all the columns proportional so that if the header was wider it would adjust accordingly, use the slider below to adjust the font-size:</p>
			</div>
			<label>
				Slide to Adjust the Header Size in Figure 1:
				<input type="range" style="width: 100%" min="0.5" max="3.0" step="0.5" value="1.0" id="header-size-range" /
			></label>
			<script>
				document.getElementById('header-size-range').addEventListener('change', function () {
					document.querySelector('#grid-placement-demo > h2').style.fontSize = this.value + 'rem';
				});
			</script>
		</section>
		
		<section>
			<h3>CSS Grid and Components</h3>
			<p>This seems like the ultimate use case for Grid!</p>
			<ul>
				<li>Components placed in the Grid will be Resized to fit the grid areas they are assigned to.</li>
				<li>Grids can also respond to the sizes of their contents, to fit the largest or smallest item in the row/column!</li>
			</ul>
			<div class="columns">
				<p>With CSS grid you get the choice of rigid or dynamic layouts. Both useful depending on your needs.</p>
				<p>A designer can design a page layout using a Grid and when the components are added they will be resized to fit into the Grid appropriately. Allowing nice seperation of concerns of page to component.</p>
				<p>The grid can be built to have some regions which will shrink or expand to fit their contents. SO it is possible to have dynamic areas which expand or contract as required.</p>
			</div>
		</section>

		<figure id="auto-flow-dense-demo" style="grid-column-start: left-start;">
			<div>
				<span class="wide" style="background-color: var(--blue);">1</span>
				<span class="tall" style="background-color: var(--blue);">2</span>
				<span class="wide tall" style="background-color: var(--magenta);">3</span>
				<span class="tall" style="background-color: var(--blue);">4</span>
				<span class="wide" style="background-color: var(--magenta);">5</span>
				<span style="background-color: var(--blue);">6</span>
			</div>
			<label style="border: none; padding: 0;"><input type="checkbox" value="off"><span class="text">grid-auto-flow: row;</span></label>
			<script>
				document.querySelector('#auto-flow-dense-demo input').addEventListener('click', function () {
					var val = this.checked ? 'dense' : 'row';
					document.querySelector('#auto-flow-dense-demo > div').style.gridAutoFlow = val;
					document.querySelector('#auto-flow-dense-demo .text').textContent = 'rid-auto-flow: ' + val + ';';
				});
			</script>
			<figcaption>See how grid-auto-flow can reorder items.</figcaption>
		</figure>

		<section>
			<h3>CSS Grid and Responsive Web Design</h3>
			<div class="columns">
				<p>CSS Grid works really well with RWD. A simple grid can have different numbers of columns and rows depending on media queries. It's children will then be moved to fit into the Grid however they can. If the grid is set to <code class="css">grid-auto-flow: dense;</code> then items will be moved out of order to fit them in as densely as possible. This is good for when order is not important such as a photo gallery but may cause accessibility issues because it has been visually reordered but still the same order in the DOM.</p>
				<p>We can gain more control when we use named grid areas and named grid edges. We can have content which always fills the same grid-area or goes between the same two named edges but change what that means depending on the context.</p>
				<p>Our grid could have 7 columns on large screens, 5 on medium sized screens and only 2 on mobile. Then we can rely on a combination of auto placement and named areas to layout our content precisely on all screen sizes.</p>
			</div>
		</section>

		<section>
			<h3>Labeling Areas</h3>
			<p>Labels are really useful for making grids easy to place items into.</p>
			<p>You can name areas in the grid using <code>grid-template-areas</code> and you can name columns/rows in the grid. In your <code>grid-template-columns</code> and <code>grid-template-rows</code></p>
			<p>In the code sample below I have defined a two column grid using <code>grid-template-columns</code>, where the first edge and the last edge have been named using square brackets.</p>
			<p>The 3 <code>grid-column</code> statements for the child are all equivalent. Making it go from one edge to the other.</p>
			<p><b>Notice</b> how we can use the area 'wide' which which was automatically generated because we have edges named 'wide-start' and 'wide-end'.</p>
			<pre><code class="css">
parent {
	display: grid;
	grid-template-columns: [wide-start] 1fr 1fr [wide-end];
}

child {
	grid-column: 1/3;

	grid-column: 1/span 2;

	grid-column: wide-start/span 2;

	grid-column: wide-start/wide-end;

	grid-column: wide;
}
			</code></pre>
		</section>
		
		<h2 id="css-custom-properties">CSS Custom Properties</h2>

		<figure style="grid-column: left-start/ right-start;">
			<pre><code class="css">
:root {
	--my-var: red;
}

p {
	color: var(--my-var);
}
			</code></pre>
			<figcaption>
				Sample CSS Variables code
			</figcaption>
		</figure>

		<section>
			<p><script>
			if (CSS && CSS.supports) {
				if (!CSS.supports('--myvar' , '3px')) {
					document.write('Your browser may not support CSS Custom Properties, some of these Demos may not work.');
				}else {
					document.write('Your browser supports CSS Custom Properties!');
				}
			} else {
				document.write('Can\'t detect CSS Custom Properties Support');
			}
			</script></p>
			
			<p>On the surface CSS Custom Properties just seem akin to static sass variables but they are so much more than that!</p>
			<blockquote cite="https://twitter.com/salvadelapuente/status/895728964714598400">
				<p>Custom properties make your CSS behave like a spreadsheet. You alter a value, everything is recomputed.</p>
				<footer>
				— <cite><a href="https://twitter.com/salvadelapuente/status/895728964714598400">@Salva</a></cite>
				</footer>
			</blockquote>
		</section>
		
		<section>
			<p>CSS Custom Properties can have their value determined by other Custom Properties or combinations therof using <code>calc()</code></p>
			<p>CSS Custom properties can be overrided at any point to change the value further down in the cascade. This allows components to use/ignore/modify the inherited custom properties as required.</p>
			<p>They can be overrided by pseudo selectors such as <code>:hover</code>, or queries such as <code>@supports</code> or <code>@media</code>. Allowing more concise CSS with less duplication as by changing one or two variable you can affect many properties.</p>
			<p>A really nice effect of having the variables calculated live in the browser rather than pre-compiled is that you can mix device specific units such as <code>1rem 2em 3vw 4ex 5cm</code> in your calculations in the stylesheet, e.g. <code>calc(10px + 1em + 3cm)</code></p>
		</section>
		
		<figure style="grid-column: left-end/right-end;">
			<pre><code>
:root {
	--a: 1em;
	--b: 10px;
	--sum-a-b: calc(var(--a) + var(--b));
}

div {
	height: var(--sum-a-b);
}
			</code></pre>
			<figcaption>
				Using calc() with custom properties.
			</figcaption>
		</figure>

		<section>
			<h3>Integrating with JavaScript</h3>
			<div class="columns">
				<p>CSS custom properties can be read and written using JavaScript!! This closer integration with JavaScript allows a further separtion of concerns by allowing us to keep our styling elements in our CSS file and read or control them using JavaScript. </p>
			</div>
		</section>

		<figure style="grid-column: left-start/right-end; max-width: 100%;">
			<pre><code class="html">
&lt;style&gt;
	:root {
		--my-prop: 3em;
	}

	#my-title {
		--my-prop: 2em;
	}
&lt;/style&gt;

&lt;script&gt;
	getComputedStyle(document.documentElement).getPropertyValue('--my-prop')
	// "3em"

	getComputedStyle(document.getElementById('my-title')).getPropertyValue('--my-prop')
	// "2em"

	document.documentElement.style.setProperty('--my-prop', '4em')
&lt;/script&gt;
			</code></pre>
			<figcaption>
				Reading and Writing CSS custom Properties
			</figcaption>
		</figure>
		
		<section>
			<p>If you update a CSS custom property, like with any CSS property, the whole document will update and all other custom properties will be updated.</p>
			<p>Try running the following code snippet in your browsers console on this page:</p>
			<pre><code class="js">
document.documentElement.style.setProperty('--blue', 'magenta')
			</code></pre>
			<p>This element, document.documentElement, corresponds to the ':root' element in CSS.</p>
			<p>You can also run this command at any point in the tree, try using the your browser's inspector to set the style of one of the headings <code>el.setAttribute('style', "--blue: firebrick;")</code> the heading should change but leave the others are left untouched.</p>
		</section>

		<h2 id="web-animations">Web Animation API</h2>
		<section>
			<p><script>
			if (typeof Animation === 'undefined') {
				document.write('Your browser does not natively support Web Animations, but we will use the polyfill library, so the demos will still work. <script src="https://cdn.rawgit.com/web-animations/web-animations-js/b0ca1f7f/web-animations.min.js"></scr'+'ipt>');
			}else {
				document.write('Your browser supports Web Animations!!');
			}
			</script>
			<!-- Polyfill for .finished cause I love it! -->
			<script src="https://cdn.rawgit.com/simevidas/2e721c8e6d67f04b5e1a0083c542a767/raw/0bd4b6bc2b5c84b488adc4137e0b3eeba183023a/finished-polyfill.js"></script></p>
			<p>Unlike CSS custom properties and CSS Grid which cannot be polyfilled performantly, there is a polyfil for the JavaScript Web Animation API. It can be downloaded from <a href="https://github.com/web-animations/web-animations-js">Web Animations on Github</a> so there is no excuse not to use it today.</p>
			<p>Animations are far more complex than I can go into in a short summary article so I <b>strongly</b> recommend watching <a href="https://vimeo.com/channels/cssday/226736126">Rachel Nabors amazing talk on Web Animations from the recent CSS Day</a>.</p>
		</section>
		
		<figure style="grid-column: left-start/right-end; max-width: 100%; display: none;">
			<pre><code class="html">

&lt;script src="https://cdn.rawgit.com/web-animations/web-animations-js/b0ca1f7f/web-animations.min.js"&gt;&lt;/script&gt;

&lt;script&gt;
	// Polyfill for Animation.prototype.finished which isn't in all native implementations yet.
	if (typeof Animation !== 'undefined' && Animation.prototype.finished === undefined) {
		Object.defineProperty(Animation.prototype, 'finished', {get: function () {
			return new Promise(function (resolve) {
				this.addEventListener('finish', resolve);
			}.bind(this));
		}});
	}
&lt;/script&gt;
			</code></pre>
			<figcaption>Polyfills for Web Animation and the Web Animation "finished" property.</figcaption>
		</figure>


		<section>
			<p><b>Until recently</b> on the web the two ways of doing animations were using CSS transitions and animations or one of the many great libraries on the Web for doing animation already such as tween.js, anime.js and Greensock.</p>
			<p>CSS animations and transitions are good for one off animations triggered by a class change. It makes sense to have the styles written declaratively but in CSS it is limited with how much they integrate with JavaSript.</p>
			<p>The API for Web Animations to me feels like a JavaScript version of the CSS Animations spec.</p>
			<p>They have a really nice property which is currently hard to achieve on the web, Web Animations are all kept in time using the document's timeline. This ensures that a 200ms animation will always take 200ms regardless of framerate or skipped frames due to lagging.</p>
		</section>

		<script id="animDemo">
var animKeyframes = [{
    opacity: 0,
    transform: 'translateX(5em)'
},{
	opacity: 1,
	offset: 0.2	
},{
    opacity: 1,
    transform: 'translateX(0) rotate(720deg) scale(2)'
}];

var animOptions = {
	direction: 'normal', // or reverse or alternate
	duration: 1000, // miliseconds
	easing: 'cubic-bezier(0.42, 0, 0.58, 1)',
	fill: 'forwards'
};
		</script>

		<script>
			function playForwards () {
				console.log(ballEl);
				ballEl.animate(animKeyframes, animOptions);
			}

			function playBackwards () {
				ballEl.animate(animKeyframes, {
					direction: 'reverse', // or reverse or alternate
					duration: 1000, // miliseconds
					easing: 'cubic-bezier(0.42, 0, 0.58, 1)',
					fill: 'forwards'
				});
			}
		</script>

		<figure style="grid-column: left-end/right-end;">
			<pre><code class="js">
				<script>document.write(animDemo.text);</script>

ballEl.animate(animKeyframes, animOptions);
			</code></pre>
			<div id="ballEl" style="width: 2em; height: 2em; border-radius: 100%; background-color: var(--magenta);"></div>
			<div>
				<button onclick="playForwards()">Play Forwards</button>
				<button onclick="playBackwards()">Play Backwards</button>
			</div>
			<figcaption>Defining the keyFrames and playing an animation.</figcaption>
		</figure>

		<section>
			<p>We have defined animation keyframes in Figure 6. the <code>offset</code> property in the second keyframe tells us this keyframe is at 0.7 through the animation.</p>
			<p>It is also possible to set easing on a per-key-frame basis too. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API/Keyframe_Formats">The docs on mdn</a> go into good detail.</p>
			<p>The point I want to make here is that integrates amazingly with custom css properties!</p>
		</section>

		<section>
			<p>You can use custom properties in your keyframe declaration, see figure 7.!!!</p>
			<p>In this example, I animate the background-color through the custom property --blue to a yellow color to the custom property --magenta.</p>
		</section>

		<figure style="grid-column: left-end/right-end;">

			<pre><code class="js">
ballEl.animate({
	backgroundColor: [
		'var(--blue)',
		'#ffff33',
		'var(--magenta)'
	]
}, animOptions);
			</code></pre>
			<div id="ballEl2" style="width: 2em; height: 2em; border-radius: 100%; background-color: var(--magenta);"></div>
			<div>
				<button onclick="ballEl2.animate({
					backgroundColor: ['var(--blue)', '#ffff33' , 'var(--magenta)']
				}, animOptions)">Play Forwards</button>
			</div>
			<figcaption>Defining the keyFrames and playing an animation.</figcaption>
		</figure>

		<section>
			<p>Because the syntax for easings is the same as that for CSS, I like to keep all my easing functions in a CSS file such as <a href="easings.css" target="_blank">easings.css</a> then read them in when defining the animation.</p>
			<p>In Figure 8. below, I use the approximation of ease in out quart from my CSS file of easings. Where I can also use in the CSS for transitions or animations.</p>
			<p>CSS custom properties are really great for reducing duplicate declarations of styles in your JS, they can all be kept in your CSS file.</p>
		</section>

		<figure style="grid-column: left-start/right-end;">
			<pre><code class="js">
el.animate(myKeyframes, {
	duration: 500,
	easing: getComputedStyle(document.documentElement).getPropertyValue('--easeInOutQuart'),
	fill: 'forwards'
});
			</code></pre>
			<figcaption>Using the easings from a css file.</figcaption>
		</figure>

		<section>
			<p>CSS variables can also help with accessibility.</p>
			<p>To continue take it a step further you can keep a duration multiplier, --durationK, in your CSS.</p>
			<p>In JavaScript and CSS animations and transitions, multiply your durations by this value.</p>
			<p>By default set the value of --durationK 1 so it has no effect on the durations.</p>
			<p>When it is set to 0, any animation which has it's duration multiplied by --durationK will happen instantly.</p>
			<p>This will help people who prefer reduced motion.</p>
		</section>

		<figure style="grid-column: left-end/right-end;">
			<pre><code class="css">
:root {
	--durationK: 1;
}

@media screen and (prefers-reduced-motion: reduce) {
	:root {
		--durationK: 0;
	}
}
			</code></pre>
			<figcaption>Using a single variable to control the speed of all animations.</figcaption>
		</figure>

		<figure style="grid-column: left-start/right-start;">
			<div id="ballEl3" style="width: 2em; height: 2em; border-radius: 100%; background-color: var(--magenta); --bounceHeight: 1;margin: auto;"></div>
			<script id="bounceSourceScript">
var bounceKeyframes = {
	transform: [
		'translateY(0)',
		'translateY(calc(-10em * var(--bounceHeight)))'
	]
};

var bounceOptions = {
	duration: 500 * Number(getComputedStyle(ballEl3).getPropertyValue('--bounceHeight')),
	fill: 'forwards',
	direction: 'alternate',
	iterations: 2,
	easing: getComputedStyle(ballEl3).getPropertyValue('--easeOutQuad')
}

var bouncing = false;
function bounce() {
	if (bouncing) return;
	bouncing = true;
	var bounceHeight = Number(getComputedStyle(ballEl3).getPropertyValue('--bounceHeight'));
	ballEl3.style.setProperty('--bounceHeight', bounceHeight * 0.7);
	var anim = ballEl3.animate(bounceKeyframes, bounceOptions);
	anim.finished.then(function () {
		bouncing = false;
		if (bounceHeight > 0.1) {
			bounce();
		} else {
			// Reset to go again
			ballEl3.style.setProperty('--bounceHeight', 1);
		}
	});
}
			</script>
			<div>
				<button onclick="bounce()">Bounce</button>
			</div>
			<figcaption>An animation is chained together.</figcaption>
		</figure>

		<section>
			<h4>Chaining Animations</h4>
			<p>The advantage of the Web Animations API over CSS animations is that it gives callbacks for when it is finished.</p>
			<p>You can use <code>anim.addEventListener('finish')</code> to detect when it has finished. It also has a <code>.finished</code> property, which is a promise which resolves when it is complete. The promise interface is really nice but hasn't been implemented everywhere yet. <a href="https://gist.github.com/simevidas/2e721c8e6d67f04b5e1a0083c542a767">Here is a short polyfill for it so you can use it today.</a></p>
			<p>In the example in Figure 10. once the animation has finished, it decreases the --bounceHeight css variable and plays the animation again.</p>
			<button onclick="bounceSource.style.display = 'block'">View the source code</button>
		</section>

		<figure id="bounceSource" style="display: none; grid-column: left-start / right-end;">
			<pre><code class="js">
// In the HTML
&lt;div id="ballEl3" style="--bounceHeight: 1;"&gt;&lt;/div&gt;

// In the JS
<script>document.write(bounceSourceScript.text)</script>
			</code></pre>
			<figcaption>Source code for the bounce demo.</figcaption>
		</figure>

		<section>
			<h2>Animating custom properties?</h2>
			<p>Today it is not possible to animate CSS custom properties using Web Animations. The problem lies in that the browser does not know the property type of CSS variables so does not know how to tween them correctly. For example it cannot work out that <code>--my-var: red</code> is supposed to be a color and not a length.</p>
			<p>A solution is in the works, as part of the upcoming Houdini APIs, by registering a custom property you can declare it's type to allow it to be tweened. This is not available in regular browsers yet though.</p>
			<p>Thanks to <a href="https://twitter.com/tabatkins/status/903254775906447361">Tab Atkins</a> for the tip!</p>
		</section>

		<h2>Thanks for reading!!</h2>

		<section>
			<p>I hope this has illustrated some of the new powers of the web which enable us to start letting go of our frameworks.</p>
			<p>By using these powerful tools being built into the platform, it will make our lives as developers easier and our products faster.</p>
			<p>It's okay that some of these tools are unavailable for some browsers today, using CSS's <code>@supports</code> selector or <code>CSS.supports('display' , 'grid')</code> in JavaScript it is possible to feature detect these new APIs and if the are unavailable we can degrade to sensible fallbacks.</p>
			<p>Eventually the fallbacks and polyfills will no longer be required and they can be deleted.</p>
		</section>

		<h2>Links</h2>

		<section>
			<ul>
				<li>https://rachelandrew.co.uk/archives/2016/04/12/flexible-sized-grids-with-auto-fill-and-minmax/</li>
				<li>https://codepen.io/cssgrid/pen/kkoZro?js-preprocessor=babel/</li>
				<li>https://css-tricks.com/snippets/css/complete-guide-grid/</li>
			</ul>
		</section>

		<script src="main.js"></script>
	</main></body>	
</html>
